import sys
import importlib
importlib.reload(sys)
from binascii import b2a_hex
from pdfminer.pdfparser import PDFParser,PDFDocument
from pdfminer.pdfinterp import PDFResourceManager, PDFPageInterpreter
from pdfminer.converter import PDFPageAggregator
from pdfminer.layout import LTTextBoxHorizontal,LAParams,LTFigure,LTImage,LTTextBox
from pdfminer.pdfinterp import PDFTextExtractionNotAllowed

'''
 解析pdf 文本，保存到txt文件中
'''
path = r'D:/tet.pdf'
def parse():
    fp = open(path, 'rb') # 以二进制读模式打开
    #用文件对象来创建一个pdf文档分析器
    praser = PDFParser(fp)
    # 创建一个PDF文档
    doc = PDFDocument()
    # 连接分析器 与文档对象
    praser.set_document(doc)
    doc.set_parser(praser)

    # 提供初始化密码
    # 如果没有密码 就创建一个空的字符串
    doc.initialize()

    # 检测文档是否提供txt转换，不提供就忽略
    if not doc.is_extractable:
        raise PDFTextExtractionNotAllowed

    # 创建PDf 资源管理器 来管理共享资源
    rsrcmgr = PDFResourceManager()
    # 创建一个PDF设备对象
    laparams = LAParams()
    device = PDFPageAggregator(rsrcmgr, laparams=laparams)
    # 创建一个PDF解释器对象
    interpreter = PDFPageInterpreter(rsrcmgr, device)

    # 循环遍历列表，每次处理一个page的内容
    for page in doc.get_pages(): # doc.get_pages() 获取page列表
        interpreter.process_page(page)
        # 接受该页面的LTPage对象
        layout = device.get_result()
        # 这里layout是一个LTPage对象 里面存放着 这个page解析出的各种对象 一般包括LTTextBox, LTFigure, LTImage, LTTextBoxHorizontal 等等 想要获取文本就获得对象的text属性，
        for i,x in enumerate(layout):
            if (isinstance(x, LTTextBox)):
                # with open(r'D:/1.txt', 'a',encoding='utf-8') as f:  # 'a'模式为追加，‘w’为写
                #     results = x.get_text()
                #     #print(results)
                #     f.write(results + '\n')
                print(x)
                pass
            elif isinstance(x,LTImage):
                print(x,'-'*50)
            else:
                print(x,i)


if __name__ == '__main__':
    #parse()
    #print(issubclass(LTTextBoxHorizontal,LTTextBox))
    a = b'89504e470d0a1a0a0000000d49484452000000320000007b080300000001b6232700000300504c54450000003c2d304b494a696a6c1e16183c172f5922562b1a14191011413537e6b4a068564e261a1d8b8e937d3566baa097c9cacd3d2137cda99b916d64c87b5f876251a464792a1022cbc6d0a9abb2d5d6d9cecfd2dbc6bf8f5882d7b2a4873c6db49286dcb19dd4d2d743474cb26d50e7e4e5e2e3e4bdbfc28b5e48b08470712d628a898c7e3664d0c6c97c7e83d9c3ba9f9998cda1917e7f87bfc0c6692956582547626268cf9f8761264cddd0d3d8d9dce2dede9f8aa33c183659392bc17555dadaddd0ad9edfbeb6686569734a38ceb0a88c346dc0937e682e578c3c709a437ab88d7c5e2e3f6f6a71b9a29a5930519f9796b3b3b7b17050b997ac795341482a29c78b74986049d29b86b1b2b5924174ad8e7fa75e3f968682a6674dc89985ca9892bb5c35a09db46a2564793365ad7c6b5f5a66873a72934177843a6f8e3d7582356e773167d3d4e099427bd1d1dd702d63f5bca5e3e2e99e467ff8c5b0c8c8d6f9c3acf5c3adf1b9a2f2b69dd9d9e96a2b60fffffff4f4fa7d346cffcbb2cdcdd8f7c0a8e4e5eeffc5aa61265affd0b9f4c0a8eaa98eecedeec5c2d2e8ebf5e89d7becaf96e3a185dedbe1bfbdcaffc9adb9b7c3db8c6ae19979732e65fcfbfea7a3b2dee1edd28362dedfe5b1afbba24882eef0f9fcc8b0451849b9b2bbeaeaeee1ae9bf8f8fcb4b2c2a2a2afa3a2bbefa787d9d8dfada9baccc2c1ffc0a4ab4f8ac5bbbdbbbcd0f3b29674296aeaa380adaab1e094728c3c74511e51d5c9cbe3c5bbedb7a0d6a294f6bba0d7d7e2aca1a3fcccb6661f60fcc2a8e99971d37b55c0b2b1ceb3b7e6cec4b77088c3c3cb8e8ba5f2ad8fdc885fe5bcaef3d5c79f98aeeeeff2f8b394c1c6d0e6dbdafdb99b862b69e9d6d1b8b6ca9693aeffd7bcaeb1c8d298828c8e91923372c1a9a2a976999ea0a48f3c7aafa8a9d78d75edbda9d4b7afebc6b7f6cbba91507bc5d0e3a45a67826d89721c60c0c8da7b3960a79391b66567a07a828783a097698df3e6e1fbefeafedece5d5660c5858b8a4167baa3a8b2a2beba5595a67e6c87376b954c5ea167570d1d2906131b83367022df946d000000f074524e53003f4a6b1a64fe060e33fe592697eafdd87bfe57fe81fd4efdb1eae1fdfbfeeeecfafe6ae6fef6d119aaefd8cefe89ebfbfcabe3cc959bd2adfdf7f3fc9325fbecdcfc816cfbfe70f6f5f4c280c9c9fba7c8cafb9555eeb6b0c0f873d4aac89aecfbe5f6fccfe7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffffffffffffffffffffffffffffffffffffffffffffffffffffffffecd298b9500000c464944415458c3ac93cf4b554114c7137cd71f8962d17315edc365921bd71904fe0b2d823373661846e691c1c03cc2fb746181e82c84876f5f7761742e64f05e6ede36a885b492164989e0ca56a64d73ff807b9f8b0eb39ccfccf97ebfe7dcf89f75bb56abcdd49e4c5c9fa8658a3102353b764d606e2e333e4d93dc1b353f7a1d6236cb28ed743ab94485d9e4606088659ce791d0edcc2032f3601031d6ce441e893c18d3568123b5a707208f3328beb01001602490181fa03cd84246826d66b000388a76ad8a18913a49923ce7c6302242c10039563a308ddeda34493443068e180102c9a3e17262e2889cf44524160271a118272007b58a441470e79cd6d672c7d19102875c84f972e49e6214089cb3da910390841244708b15883118550348693988d8244817113b52ead7645f29c614110f52a2905e3a2785e07eb4dcb0be32ca18a5908316c26bed8b8fc0972fc14c5da98814a128f64c48abb5d4413a3f542e66e134c4c68a635810425b2d6de1600572f3dcf71c09014820a4d3a98d7efbd45504f3e8d6f8b78b3dc420c35e7c5c27692c6b61a162e50f9bcd17bf9696acd57f7e2e5a9d2405a1a16267865bcde7875357577fcf2f0f76f24417a323b93b12e5c89d56b3bbdb3c3b3b9ffa7c70d95992d1300f8cd094bb3cbefffd63aba8d58dadd3dc7a8e028031cacaf57fe85fec6cbc5a5fdf7ebf75dab3de3215038a9eb74bc58cacf64ffaefb6b6b75f7fa9f7dc7d90a0543c8aa11c2e8ba5d93fd93fec76bb9f56eb8e4b903c5e2f1092d325c8c3cde3ded356a3d158deec0b35290407860190842c99ffd1b72f8f7be3ddc6cacaf2e6efaf06414048f7bc7700564c97f4f5e66e6fa5db585b5bdbfd41860907ced6dd3f36cb24a689280ee34645c4a5c60d341189e841510f1a3592a0c62526ae17e3c58b894b184adba174a3633b4c8bd84c290c53ecb44caba5ed942e76a5a995e2065a405b3641b456c4057117352a460f38dc28f0eebffcffdf7bdff7e5b18a2ec0ac9cfc69910d3f3abf6489c6a788f88fefc7e9740217d21f97c8d2af5e84733847a743d6183eec4be7f38534c1bff992398edcfa592dac1ebc789105337873a771cbbd30f4c82412c9f8e3a77c680c2e647a4d574495ed1f8be0c2ace98a76be0dac8a89f89764e3534a6f0270c158fe2f85a272b07d782c404bdb358d945c25227f2d1409e9c37fb30f860b02f0b0afb241ddfe7900e01c0658195310cf6b6d4cf0882b945dbf9e4b5adf79613a66776b2a067534c2e01d66c1dba6b8b8baa385dd69bbfd60b356cb8ea1ef59f9003cbce64b855ad70e0c3039bccb4585a993fc256e6cebfe4db983880004ab6c99ef8b38404f9ed53b58a3d601ccc3cc40d16560f624f1d52a4fd981c59415abb3d9e427de178cc47907df1d9b93eed32d1be09cd21714b17829c9cc06679bb87b775a53532b595585f6648e37b3e6b7977db3807ae3443070e814eb72409f95fc3426a7985bbf7425b1e4198120c61e7be6bb3893c70b9c3b3b5cf1cbcb60d2e504e893af6c77a94cd6384f59871b9b7f531409742672804226a007583983777edda2bb09e63192e37ca0fc92b0ade56da71f03318af20fe5fd3e483fdfe20c1ec77bbfbb46fdcf1be0f07626c7f9482957a60041cce50f1a49d29148b470fe8ee81933366df2fe748aeb3fe7033c4646466a9294b24b9e074ad065b4e32ebf1fc746123d9ccc16cec95460db7967a36f1987776de78c24f5b3af70b9f5413662341298b1a9e9c5bd961343f18327f489ad3b5396578b7dcb7236fd9964cbfda5251daf3ea0f2eca811432c162ae8326e2e88675e1b82b6ce48292ff1e95232fe642d489b3026f57859f7bcb7a8c080508e88cbe120825d5d11e310bd5b277b7f4a09d7b787fe12300f4d943f73b5b363b31b944608ac996872b90863b3c3e17025e27ff3fa9133a6c68a75534cbc50d86dea679b0584852db0f89b9b895cdb0a972398cbbcd6f315fa60f2d44c415257393b825a7336410aa420c4b6dba945cdd98fbaf068d66882a135dcf034ec998ca4957bb88658d842e26c090a2a11c402a1386eb1a0a399a33dbd9a870a75c3ca49c69f55aa12cbc3167f2452ac71437292c4c31004b9ad7df6febc023bf45da1d649362623479c6295cd6d27eb70b9d96d901344a4585b07a1a81b2dce6bed737f53e874cadee4960c71c5210149b26b293a8e923a8a42b5728944e9eeb7424aeb576b579bfa6ef0eddce4960c7956f547c85a8cc4e46c4936412061ad462245ad564803b6b6aef034a8d5585ad25eb7558d4624fb391a41a2024883d9ed60989ea241a2515063e8ffbac4535959b168ed0462bdc9a730f54a6bb14815824721258ee361b652a29140d63e81d40c11f50a854a7c63c7c4bdca9e984cca582d0622612965d1d2a9d4a2f46212b9bdaf57a931b4a854a110b7f1d8c436726ed9fb505a8744d8e1582dde6a21351aa900914a24d2de3e2b6436cc1387422525f59f2620a7c5dcdc98b92a8214d39304d853d26cfedf7899bd361145613c1b24ad868450c1262554db348ad8c582420beee28b8a8a2b2ee01f300c33646212326492215bb3181b4a3392e098d68c2db5b401b355dab4a1b6a9b14a5c1a4a295d101141d437dfbc4d414a31e39cb779f8f19d7bbf73e79c632e60e03051ecc36b2cac193602223951bf05b9717de1a2dcc5cc5305149b6798c7cffafa5073d8143583c380cc12333e239274c62e6c454e4bc45a1745450b0c4cc1f033c8ed7e0877d94066bd4f5fbdfa64503f4b3ac195f9855b6e4c0caa1f8fba9a709a6260ac0f76bb69f77b0cea8a424fbf7f7935057fce7b7cc133a69bdb2a53e092cbfd2e0a62a61f61288a3ef713d3c4833eec517f1f46cc273cf1559309df3e62f06b5d4dca02453deeb70182a03219f80141bb1f6210fc35117ff1d916b60978db99828a0ebb5c94dfe67613fe0c6122b00c8d3d8020e86b3ed54b6584cdc2ed8890d66a954a39dd0354d00c0c6730378aba9f433081bd204ce16661ad783b22ba78bc598a77aad0288ebb5098810988869f633001c3149509df948afe31c1482f5d6aa7d1e3ae9e9e280e84181b0dbb331091c950361497fe7beae1efe01dc4330c451d3fde534069170a0101988228aa0315f22a45dd0f4d6f47875ca5a269a0e4a7801a45c961c65c11e1ff6c59fb0941d31a796753a140a37ed44699944d288cefa83829fed2b49cd46820c60633cf5c05060de3142397a390b0e2a878847cab6c999bb365e0f907588752abdaddaea1544a5c2a1054202488d5faa3b3a5e547b8abd7d4dbb5975681326a6fc26b9bdb2b21020b32fcd2d5d9595cab2be6d68b10417529b5ed4d5ade0ea1b8d2684d1a878df6f575ef3d8162e19a93b675154fd4f28517252cd3b8de68448c1e4fb651aa52e7af15a3b9b66bc2e64b221e0b320e10abd3397b5b246dcfb5acfaceb49d3c542be0b1c4d9f4b011410c86e0319e44f8b6985ae8d89babe7b106688b06c48a20be1a09b0d513f2a59e046745acc8fe8001d950f1d5ec035fe726b2d96c28be8b153932be8904bb8f6e7c36766743a1eecbacc89ebf08bfdcaae2a16ca8fb182bf284441c566b3219ecdeacc22b13719f37c86721c42b7ac77d87d5680c766fb6860b838e88c5f75b5c19d917b13ac05cedf50643fbca6bf6097bc432f2bb8605a9b23b00e20048cde66a9a0c38aa171716d8ccb76c88189c4ecff58d340fb70e4dbea84b790eb1995f46923e5fbcfca0ce2c8da963b3d99484cdfc8f00b17a63b1bb65cdc4d8e2c0991adf2156f3ed00419c1e0f7fe360e4683eb05ef77654c2869c8838eeeb8c338d8de5bd6cb14446d2d9d52a76f30102f2ba7a75a376f27d2b8188a76d49c26e3e4010675c22e1890cf6922c10191e3905ea98d57c9d035c31f0a4aa6eb275808ce8e20a560d60be0538e98d5da9aa5a5628beb53a2c4ecf66b367375feff59c96c9a6fa97f7241e1a66dbca22ece63b1067e80e5891d54bfd7b72dfca22ec2a16bdd5e06cacfdf52b3db832bafc6e11cc60ff4d4cafb70edf969acd9171cbd8c35cabf8bfc84e80e88da12b0411eec98d1ea8f0afdfb65d00c430a216892402be88c7256e01155d3a98b87c99c735eaed0192f42dae4d4c8839120d8f17abf3ab5373e99999531c91d6e95659dd5a603c565d2de49a57a9a41824758689fa7a8e842031840c4c22e4885720e0881c595a0d90c583ce99ad9eb3fbb8567a62d10fce8dc9c45c91fd4303a45e1f79a338cf95e0e74b4f027a9d7ee4f00e8ec4ade5d14459a49eabc679f59e928c2475696f0347e2ce40ff586a6a72dc12fbc69110dbc7d5a34b6db9a13706ae22d28f6972657929a59071b6446b8ea407ab97c7aa3913bc0614ff39971b7adccce31e550d52a9b481d33bfc031e9bf11f3f7540280000000049454e44ae426082'
    bs = b'x\x01\xed\xd0\x01\r\x00\x00\x00\xc2\xa0\xf7Om\x0f\x07\x11(\x0c\x180`\xc0\x80\x01\x03\x06\x0c\x18x\x18\x18\x0b\xdc\x00\x01'
    open("D:/a.png", "wb").write(b2a_hex(a).decode())
    print(b2a_hex(b'x\x01\xed\xd0'))
